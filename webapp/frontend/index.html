<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Skill Graph</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .card {
            display: inline-block;
            margin: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1 id="welcome-message"></h1>
    <label for="student-id-input">Enter Student ID:</label>
    <input id="student-id-input" min="1" value="1">
    <button id="fetch-data-button">Fetch Data</button>
    <div id="cards-container"></div>
    <script>
        const skillIds = [1, 2, 3];

        function fetchData(studentId, skillId) {
            return $.get(`/student/${studentId}/skill/${skillId}`);
        }

        function createGraphCard(skillId, scores) {
            const graphId = `graph-${skillId}`;
            const card = $(`<div class="card"><div id="${graphId}"></div></div>`);

            const trace = {
                x: scores.map((_, i) => i + 1),
                y: scores,
                mode: 'lines',
                name: `Skill ${skillId}`
            };

            const layout = {
                title: `Skill ${skillId}`,
                xaxis: {title: 'Data Points'},
                yaxis: {title: 'Score'}
            };

            Plotly.newPlot(graphId, [trace], layout);
            return card;
        }

        function updateWelcomeMessage(studentId) {
            const welcomeMessage = $(`#welcome-message`);
            welcomeMessage.text(`Welcome, Student ${studentId}`);
        }

        function updateGraphs(studentId) {
            const cardsContainer = $('#cards-container');
            cardsContainer.empty();
            skillIds.forEach(skillId => {
                fetchData(studentId, skillId).then(scores => {
                    const card = createGraphCard(skillId, scores);
                    cardsContainer.append(card);
                });
            });
        }

        $(document).ready(function () {
            const studentIdInput = $('#student-id-input');
            const fetchDataButton = $('#fetch-data-button');
            let studentId = parseInt(studentIdInput.val());
            updateWelcomeMessage(studentId);
            updateGraphs(studentId);

            fetchDataButton.on('click', function () {
                studentId = parseInt(studentIdInput.val());
                updateWelcomeMessage(studentId);
                updateGraphs(studentId);
            });
        });
    </script>
</body>
</html>
