<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABLLS-R Student Summary</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1 class="page-title">ABLLS-R Student Summary</h1>
    <h2 id="welcome-message"></h2>
    <label for="student-id-input">Enter Student ID:</label>
    <input id="student-id-input" type="text" value="V1_100">
    <button id="fetch-data-button">Fetch Data</button>
    <div id="cards-container"></div>
    <script>
        const skillIds = {
            A: "Cooperation and Reinforcer Effectiveness",
            B: "Visual Performance",
            C: "Receptive Language"
        };

        function fetchData(studentId, skillLetter) {
            return $.get(`https://backend-student-status.azurewebsites.net/student/${studentId}/skill/${skillLetter}`);
        }

        function createGraphCard(skillLetter, skillName, scores) {
            const graphId = `graph-${skillLetter}`;
            const card = $(`<div class="card"><div id="${graphId}"></div></div>`);

            const trace = {
                x: scores.map((_, i) => i + 1),
                y: scores,
                mode: 'lines',
                name: skillName
            };

            const layout = {
                title: skillName,
                xaxis: {title: 'Data Points'},
                yaxis: {title: 'Score'}
            };

            Plotly.newPlot(graphId, [trace], layout);
            return card;
        }

        function updateWelcomeMessage(studentId) {
            const welcomeMessage = $(`#welcome-message`);
            welcomeMessage.text(`Welcome, Student ${studentId}`);
        }

        function updateGraphs(studentId) {
            const cardsContainer = $('#cards-container');
            cardsContainer.empty();
            for (const [skillLetter, skillName] of Object.entries(skillIds)) {
                fetchData(studentId, skillLetter).then(scores => {
                    const card = createGraphCard(skillLetter, skillName, scores);
                    cardsContainer.append(card);
                });
            }
        }

        $(document).ready(function () {
            const studentIdInput = $('#student-id-input');
            const fetchDataButton = $('#fetch-data-button');
            let studentId = studentIdInput.val();
            updateWelcomeMessage(studentId);
            updateGraphs(studentId);

            fetchDataButton.on('click', function () {
                studentId = studentIdInput.val();
                updateWelcomeMessage(studentId);
                updateGraphs(studentId);
            });
        });
    </script>
</body>
</html>
